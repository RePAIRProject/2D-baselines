import unittest
import sys
sys.path.append("geometric greedy solver")

from src.assembler import restore_assembly_img 
from src.piece import Piece
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from PIL import Image
import os
from io import StringIO
from src.assembler import rigid_transformations
import json
from src import DIR_OF_PIECES_IMAGES

correct_pairwise_data = {
        "AfterEnableCollision": {
            "springs": [
                {
                    "firstPieceId": "RPf_00194_intact_mesh",
                    "firstPieceVertex": 17,
                    "secondPieceId": "RPf_00197_intact_mesh",
                    "secondPieceVertex": 44,
                    "snapshotedLength": 193.16224670410156
                },
                {
                    "firstPieceId": "RPf_00194_intact_mesh",
                    "firstPieceVertex": 15,
                    "secondPieceId": "RPf_00197_intact_mesh",
                    "secondPieceVertex": 42,
                    "snapshotedLength": 184.54270935058594
                }
            ],
            "sumSpringsLength": 377.0
        },
        "piecesBeforeCollisionCoords": [
            {
                "coordinates": [
                    [
                        -692.0327758789063,
                        -517.2882080078125
                    ],
                    [
                        -753.76318359375,
                        -598.388671875
                    ],
                    [
                        -759.255859375,
                        -656.1803588867188
                    ],
                    [
                        -736.763427734375,
                        -723.0162353515625
                    ],
                    [
                        -748.8007202148438,
                        -870.5973510742188
                    ],
                    [
                        -722.7320556640625,
                        -952.239013671875
                    ],
                    [
                        -729.5603637695313,
                        -969.8280639648438
                    ],
                    [
                        -698.4271850585938,
                        -1011.4783935546875
                    ],
                    [
                        -695.5222778320313,
                        -1070.483154296875
                    ],
                    [
                        -610.1417236328125,
                        -1082.8203125
                    ],
                    [
                        -478.63623046875,
                        -1141.831787109375
                    ],
                    [
                        -365.651123046875,
                        -1151.0135498046875
                    ],
                    [
                        -319.2996826171875,
                        -1181.2882080078125
                    ],
                    [
                        -236.08778381347656,
                        -1174.0218505859375
                    ],
                    [
                        -169.728271484375,
                        -1199.32861328125
                    ],
                    [
                        -118.59559631347656,
                        -1241.0108642578125
                    ],
                    [
                        8.799076080322266,
                        -1244.4156494140625
                    ],
                    [
                        113.34657287597656,
                        -1277.384033203125
                    ],
                    [
                        154.8023223876953,
                        -1242.650390625
                    ],
                    [
                        158.10250854492188,
                        -1180.255859375
                    ],
                    [
                        181.16854858398438,
                        -1139.2926025390625
                    ],
                    [
                        244.48489379882813,
                        -1066.99462890625
                    ],
                    [
                        311.95208740234375,
                        -1025.3028564453125
                    ],
                    [
                        385.9634094238281,
                        -893.8216552734375
                    ],
                    [
                        376.33465576171875,
                        -787.4059448242188
                    ],
                    [
                        299.529052734375,
                        -666.2825927734375
                    ],
                    [
                        337.1410217285156,
                        -534.5430297851563
                    ],
                    [
                        340.6676940917969,
                        -455.74853515625
                    ],
                    [
                        317.8844299316406,
                        -445.3115234375
                    ],
                    [
                        242.0596923828125,
                        -460.7896728515625
                    ],
                    [
                        112.2698745727539,
                        -454.1811828613281
                    ],
                    [
                        65.63568115234375,
                        -475.3059997558594
                    ],
                    [
                        32.05156326293945,
                        -465.4521789550781
                    ],
                    [
                        -23.571012496948242,
                        -479.562744140625
                    ],
                    [
                        -72.74579620361328,
                        -463.88385009765625
                    ],
                    [
                        -127.9964370727539,
                        -495.19488525390625
                    ],
                    [
                        -145.77960205078125,
                        -484.7659912109375
                    ],
                    [
                        -291.83099365234375,
                        -516.5314331054688
                    ],
                    [
                        -338.2143859863281,
                        -506.25701904296875
                    ],
                    [
                        -378.8451843261719,
                        -525.3915405273438
                    ],
                    [
                        -454.2174072265625,
                        -508.0704345703125
                    ],
                    [
                        -531.0535278320313,
                        -530.547119140625
                    ],
                    [
                        -576.4179077148438,
                        -508.2740478515625
                    ],
                    [
                        -598.4406127929688,
                        -522.2387084960938
                    ]
                ],
                "pieceId": "RPf_00194_intact_mesh"
            },
            {
                "coordinates": [
                    [
                        -525.5803833007813,
                        -1128.9376220703125
                    ],
                    [
                        -606.7619018554688,
                        -1232.2601318359375
                    ],
                    [
                        -612.8687744140625,
                        -1248.12548828125
                    ],
                    [
                        -599.8244018554688,
                        -1254.0286865234375
                    ],
                    [
                        -663.1536254882813,
                        -1257.260009765625
                    ],
                    [
                        -695.9862670898438,
                        -1309.4805908203125
                    ],
                    [
                        -680.6778564453125,
                        -1539.5733642578125
                    ],
                    [
                        -696.4487915039063,
                        -1689.44091796875
                    ],
                    [
                        -671.476318359375,
                        -1785.531494140625
                    ],
                    [
                        -690.6685791015625,
                        -1855.0416259765625
                    ],
                    [
                        -667.3402709960938,
                        -1924.78271484375
                    ],
                    [
                        -677.031982421875,
                        -2098.483642578125
                    ],
                    [
                        -580.514404296875,
                        -2185.55517578125
                    ],
                    [
                        -514.5678100585938,
                        -2185.348388671875
                    ],
                    [
                        -495.7356262207031,
                        -2199.467529296875
                    ],
                    [
                        -420.3085632324219,
                        -2185.765869140625
                    ],
                    [
                        -270.9360046386719,
                        -2188.740234375
                    ],
                    [
                        -225.40521240234375,
                        -2206.20263671875
                    ],
                    [
                        -152.84298706054688,
                        -2183.078125
                    ],
                    [
                        -32.26137161254883,
                        -2221.5498046875
                    ],
                    [
                        26.398656845092773,
                        -2194.587158203125
                    ],
                    [
                        88.21534729003906,
                        -2192.664794921875
                    ],
                    [
                        283.26416015625,
                        -2220.910400390625
                    ],
                    [
                        420.17266845703125,
                        -2180.44921875
                    ],
                    [
                        471.95623779296875,
                        -2189.85546875
                    ],
                    [
                        483.6883239746094,
                        -2125.478759765625
                    ],
                    [
                        468.7218322753906,
                        -2057.7587890625
                    ],
                    [
                        429.1219482421875,
                        -1987.552978515625
                    ],
                    [
                        384.8113708496094,
                        -1953.1640625
                    ],
                    [
                        325.07037353515625,
                        -1867.3271484375
                    ],
                    [
                        325.34503173828125,
                        -1834.0264892578125
                    ],
                    [
                        307.6763000488281,
                        -1813.6107177734375
                    ],
                    [
                        311.72845458984375,
                        -1708.2705078125
                    ],
                    [
                        292.4146423339844,
                        -1661.505126953125
                    ],
                    [
                        300.627685546875,
                        -1586.949462890625
                    ],
                    [
                        261.82745361328125,
                        -1525.3089599609375
                    ],
                    [
                        264.67608642578125,
                        -1485.8135986328125
                    ],
                    [
                        241.1613311767578,
                        -1467.81201171875
                    ],
                    [
                        241.2900848388672,
                        -1426.70263671875
                    ],
                    [
                        157.33575439453125,
                        -1312.8885498046875
                    ],
                    [
                        114.33457946777344,
                        -1280.0115966796875
                    ],
                    [
                        46.57029724121094,
                        -1285.7586669921875
                    ],
                    [
                        63.71402359008789,
                        -1264.308837890625
                    ],
                    [
                        25.439260482788086,
                        -1244.533935546875
                    ],
                    [
                        -68.67408752441406,
                        -1251.9254150390625
                    ],
                    [
                        -129.06646728515625,
                        -1234.099853515625
                    ],
                    [
                        -223.38674926757813,
                        -1175.544677734375
                    ],
                    [
                        -271.3456115722656,
                        -1172.0859375
                    ],
                    [
                        -291.7613830566406,
                        -1189.755126953125
                    ],
                    [
                        -369.5177917480469,
                        -1147.2823486328125
                    ],
                    [
                        -407.1073303222656,
                        -1157.3323974609375
                    ],
                    [
                        -466.5980224609375,
                        -1146.6614990234375
                    ],
                    [
                        -491.7707214355469,
                        -1122.15966796875
                    ]
                ],
                "pieceId": "RPf_00197_intact_mesh"
            }
        ],
        "piecesBeforeCollisionTransformations": [
            {
                "pieceId": "RPf_00194_intact_mesh",
                "rotationRadians": -2.499699354171753,
                "translateVectorX": 0.0,
                "translateVectorY": 0.0
            },
            {
                "pieceId": "RPf_00197_intact_mesh",
                "rotationRadians": -2.428189277648926,
                "translateVectorX": -173.1986846923828,
                "translateVectorY": -1729.5875244140625
            }
        ],
        "piecesFinalCoords": [
            {
                "coordinates": [
                    [
                        -692.0327758789063,
                        -517.2882080078125
                    ],
                    [
                        -753.76318359375,
                        -598.388671875
                    ],
                    [
                        -759.255859375,
                        -656.1803588867188
                    ],
                    [
                        -736.763427734375,
                        -723.0162353515625
                    ],
                    [
                        -748.8007202148438,
                        -870.5973510742188
                    ],
                    [
                        -722.7320556640625,
                        -952.239013671875
                    ],
                    [
                        -729.5603637695313,
                        -969.8280639648438
                    ],
                    [
                        -698.4271850585938,
                        -1011.4783935546875
                    ],
                    [
                        -695.5222778320313,
                        -1070.483154296875
                    ],
                    [
                        -610.1417236328125,
                        -1082.8203125
                    ],
                    [
                        -478.63623046875,
                        -1141.831787109375
                    ],
                    [
                        -365.651123046875,
                        -1151.0135498046875
                    ],
                    [
                        -319.2996826171875,
                        -1181.2882080078125
                    ],
                    [
                        -236.08778381347656,
                        -1174.0218505859375
                    ],
                    [
                        -169.728271484375,
                        -1199.32861328125
                    ],
                    [
                        -118.59559631347656,
                        -1241.0108642578125
                    ],
                    [
                        8.799076080322266,
                        -1244.4156494140625
                    ],
                    [
                        113.34657287597656,
                        -1277.384033203125
                    ],
                    [
                        154.8023223876953,
                        -1242.650390625
                    ],
                    [
                        158.10250854492188,
                        -1180.255859375
                    ],
                    [
                        181.16854858398438,
                        -1139.2926025390625
                    ],
                    [
                        244.48489379882813,
                        -1066.99462890625
                    ],
                    [
                        311.95208740234375,
                        -1025.3028564453125
                    ],
                    [
                        385.9634094238281,
                        -893.8216552734375
                    ],
                    [
                        376.33465576171875,
                        -787.4059448242188
                    ],
                    [
                        299.529052734375,
                        -666.2825927734375
                    ],
                    [
                        337.1410217285156,
                        -534.5430297851563
                    ],
                    [
                        340.6676940917969,
                        -455.74853515625
                    ],
                    [
                        317.8844299316406,
                        -445.3115234375
                    ],
                    [
                        242.0596923828125,
                        -460.7896728515625
                    ],
                    [
                        112.2698745727539,
                        -454.1811828613281
                    ],
                    [
                        65.63568115234375,
                        -475.3059997558594
                    ],
                    [
                        32.05156326293945,
                        -465.4521789550781
                    ],
                    [
                        -23.571012496948242,
                        -479.562744140625
                    ],
                    [
                        -72.74579620361328,
                        -463.88385009765625
                    ],
                    [
                        -127.9964370727539,
                        -495.19488525390625
                    ],
                    [
                        -145.77960205078125,
                        -484.7659912109375
                    ],
                    [
                        -291.83099365234375,
                        -516.5314331054688
                    ],
                    [
                        -338.2143859863281,
                        -506.25701904296875
                    ],
                    [
                        -378.8451843261719,
                        -525.3915405273438
                    ],
                    [
                        -454.2174072265625,
                        -508.0704345703125
                    ],
                    [
                        -531.0535278320313,
                        -530.547119140625
                    ],
                    [
                        -576.4179077148438,
                        -508.2740478515625
                    ],
                    [
                        -598.4406127929688,
                        -522.2387084960938
                    ]
                ],
                "pieceId": "RPf_00194_intact_mesh"
            },
            {
                "coordinates": [
                    [
                        -535.8743286132813,
                        -1172.472412109375
                    ],
                    [
                        -617.0558471679688,
                        -1275.794921875
                    ],
                    [
                        -623.1627197265625,
                        -1291.6602783203125
                    ],
                    [
                        -610.1183471679688,
                        -1297.5634765625
                    ],
                    [
                        -673.4475708007813,
                        -1300.7947998046875
                    ],
                    [
                        -706.2802124023438,
                        -1353.015380859375
                    ],
                    [
                        -690.9718017578125,
                        -1583.108154296875
                    ],
                    [
                        -706.7427368164063,
                        -1732.9755859375
                    ],
                    [
                        -681.770263671875,
                        -1829.066162109375
                    ],
                    [
                        -700.9625244140625,
                        -1898.576416015625
                    ],
                    [
                        -677.6342163085938,
                        -1968.3173828125
                    ],
                    [
                        -687.325927734375,
                        -2142.0185546875
                    ],
                    [
                        -590.808349609375,
                        -2229.08984375
                    ],
                    [
                        -524.86181640625,
                        -2228.883056640625
                    ],
                    [
                        -506.0295715332031,
                        -2243.002197265625
                    ],
                    [
                        -430.6025390625,
                        -2229.300537109375
                    ],
                    [
                        -281.2299499511719,
                        -2232.27490234375
                    ],
                    [
                        -235.6991729736328,
                        -2249.7373046875
                    ],
                    [
                        -163.13694763183594,
                        -2226.613037109375
                    ],
                    [
                        -42.555328369140625,
                        -2265.084716796875
                    ],
                    [
                        16.104698181152344,
                        -2238.121826171875
                    ],
                    [
                        77.92138671875,
                        -2236.199462890625
                    ],
                    [
                        272.9701843261719,
                        -2264.4453125
                    ],
                    [
                        409.87872314453125,
                        -2223.98388671875
                    ],
                    [
                        461.6622619628906,
                        -2233.39013671875
                    ],
                    [
                        473.3943786621094,
                        -2169.013427734375
                    ],
                    [
                        458.4278869628906,
                        -2101.29345703125
                    ],
                    [
                        418.8280029296875,
                        -2031.0877685546875
                    ],
                    [
                        374.5174255371094,
                        -1996.69873046875
                    ],
                    [
                        314.7763977050781,
                        -1910.8619384765625
                    ],
                    [
                        315.0510559082031,
                        -1877.561279296875
                    ],
                    [
                        297.3823547363281,
                        -1857.1455078125
                    ],
                    [
                        301.43450927734375,
                        -1751.80517578125
                    ],
                    [
                        282.1206970214844,
                        -1705.0399169921875
                    ],
                    [
                        290.333740234375,
                        -1630.4842529296875
                    ],
                    [
                        251.5334930419922,
                        -1568.84375
                    ],
                    [
                        254.3821258544922,
                        -1529.3482666015625
                    ],
                    [
                        230.86737060546875,
                        -1511.3468017578125
                    ],
                    [
                        230.99612426757813,
                        -1470.2374267578125
                    ],
                    [
                        147.0417938232422,
                        -1356.42333984375
                    ],
                    [
                        104.04061889648438,
                        -1323.54638671875
                    ],
                    [
                        36.27634048461914,
                        -1329.29345703125
                    ],
                    [
                        53.42006301879883,
                        -1307.8436279296875
                    ],
                    [
                        15.14530086517334,
                        -1288.0687255859375
                    ],
                    [
                        -78.96804809570313,
                        -1295.460205078125
                    ],
                    [
                        -139.3604278564453,
                        -1277.634521484375
                    ],
                    [
                        -233.6807098388672,
                        -1219.0794677734375
                    ],
                    [
                        -281.6395568847656,
                        -1215.6207275390625
                    ],
                    [
                        -302.05535888671875,
                        -1233.2899169921875
                    ],
                    [
                        -379.8117370605469,
                        -1190.8170166015625
                    ],
                    [
                        -417.40130615234375,
                        -1200.8670654296875
                    ],
                    [
                        -476.8919677734375,
                        -1190.1961669921875
                    ],
                    [
                        -502.0646667480469,
                        -1165.6944580078125
                    ]
                ],
                "pieceId": "RPf_00197_intact_mesh"
            }
        ],
        "piecesFinalTransformations": [
            {
                "pieceId": "RPf_00194_intact_mesh",
                "rotationRadians": -2.499699354171753,
                "translateVectorX": 0.0,
                "translateVectorY": 0.0
            },
            {
                "pieceId": "RPf_00197_intact_mesh",
                "rotationRadians": -2.428189277648926,
                "translateVectorX": -183.49264526367188,
                "translateVectorY": -1773.1221923828125
            }
        ]
}

json_rpf_352_rpf_359 = {
    "piecesFinalTransformations": [
        {
            "pieceId": "RPf_00352_intact_mesh",
            "rotationRadians": -1.3984450101852417,
            "translateVectorX": 0.0,
            "translateVectorY": 0.0
        },
        {
            "pieceId": "RPf_00359_intact_mesh",
            "rotationRadians": -2.9770328998565674,
            "translateVectorX": 525.4268188476563,
            "translateVectorY": 218.29222106933594
        }
    ],
    "piecesFinalCoords": [
        {
            "coordinates": [
                [
                    222.6066436767578,
                    -1278.7684326171875
                ],
                [
                    233.7894287109375,
                    -1302.1983642578125
                ],
                [
                    303.3580627441406,
                    -1328.658935546875
                ],
                [
                    316.9841613769531,
                    -1348.617431640625
                ],
                [
                    374.94085693359375,
                    -1360.8607177734375
                ],
                [
                    489.9196472167969,
                    -1414.9417724609375
                ],
                [
                    530.9619750976563,
                    -1452.459228515625
                ],
                [
                    606.0562133789063,
                    -1469.8389892578125
                ],
                [
                    630.7334594726563,
                    -1494.979736328125
                ],
                [
                    803.5735473632813,
                    -1502.447021484375
                ],
                [
                    846.7540283203125,
                    -1517.261474609375
                ],
                [
                    876.9092407226563,
                    -1503.892822265625
                ],
                [
                    885.5094604492188,
                    -1442.5086669921875
                ],
                [
                    871.8394775390625,
                    -1416.4656982421875
                ],
                [
                    902.15869140625,
                    -1357.3912353515625
                ],
                [
                    911.60009765625,
                    -1207.5518798828125
                ],
                [
                    858.0379028320313,
                    -1098.1158447265625
                ],
                [
                    833.8927612304688,
                    -918.59814453125
                ],
                [
                    779.142333984375,
                    -872.3010864257813
                ],
                [
                    769.1954956054688,
                    -815.1607055664063
                ],
                [
                    820.585205078125,
                    -737.192138671875
                ],
                [
                    787.0120849609375,
                    -526.8325805664063
                ],
                [
                    818.6988525390625,
                    -452.2952880859375
                ],
                [
                    805.3855590820313,
                    -247.54522705078125
                ],
                [
                    819.7249755859375,
                    -184.14495849609375
                ],
                [
                    808.4144287109375,
                    -165.8134307861328
                ],
                [
                    691.2135620117188,
                    -145.6146240234375
                ],
                [
                    664.5221557617188,
                    -114.7346420288086
                ],
                [
                    619.5869140625,
                    -107.33222198486328
                ],
                [
                    514.4557495117188,
                    -28.188703536987305
                ],
                [
                    488.62646484375,
                    -25.579450607299805
                ],
                [
                    486.0534362792969,
                    -10.801314353942871
                ],
                [
                    377.2010498046875,
                    37.24098205566406
                ],
                [
                    374.62994384765625,
                    52.01911544799805
                ],
                [
                    340.8736877441406,
                    59.33951950073242
                ],
                [
                    323.6980285644531,
                    47.21450424194336
                ],
                [
                    329.24267578125,
                    -60.43052291870117
                ],
                [
                    295.80877685546875,
                    -189.06973266601563
                ],
                [
                    299.9820556640625,
                    -312.1776428222656
                ],
                [
                    286.7488708496094,
                    -323.617919921875
                ],
                [
                    288.51507568359375,
                    -386.24188232421875
                ],
                [
                    269.12115478515625,
                    -455.5950012207031
                ],
                [
                    282.16741943359375,
                    -600.5057983398438
                ],
                [
                    266.7178955078125,
                    -692.5181884765625
                ],
                [
                    277.7385559082031,
                    -761.6519775390625
                ],
                [
                    257.0171203613281,
                    -829.2064208984375
                ],
                [
                    267.4446105957031,
                    -953.256591796875
                ],
                [
                    253.39697265625,
                    -965.8526611328125
                ],
                [
                    261.8007507324219,
                    -1014.1257934570313
                ],
                [
                    233.8828887939453,
                    -1086.994140625
                ],
                [
                    243.27658081054688,
                    -1158.4415283203125
                ],
                [
                    217.62464904785156,
                    -1203.50830078125
                ]
            ],
            "pieceId": "RPf_00352_intact_mesh"
        },
        {
            "coordinates": [
                [
                    311.1114501953125,
                    514.9555053710938
                ],
                [
                    290.88018798828125,
                    496.3912658691406
                ],
                [
                    278.1829833984375,
                    432.4474182128906
                ],
                [
                    281.7516174316406,
                    349.91644287109375
                ],
                [
                    248.4378662109375,
                    172.05618286132813
                ],
                [
                    260.23291015625,
                    101.02843475341797
                ],
                [
                    297.38616943359375,
                    97.06114959716797
                ],
                [
                    344.21728515625,
                    59.22126388549805
                ],
                [
                    452.69390869140625,
                    16.414642333984375
                ],
                [
                    584.6500244140625,
                    -82.30208587646484
                ],
                [
                    641.84375,
                    -109.29869842529297
                ],
                [
                    715.4884033203125,
                    -119.36949920654297
                ],
                [
                    742.929443359375,
                    -144.2108154296875
                ],
                [
                    766.7750854492188,
                    -129.09889221191406
                ],
                [
                    758.5849609375,
                    -79.77485656738281
                ],
                [
                    781.949951171875,
                    -43.457027435302734
                ],
                [
                    780.7120971679688,
                    86.09008026123047
                ],
                [
                    759.3688354492188,
                    135.25962829589844
                ],
                [
                    747.4574584960938,
                    286.34832763671875
                ],
                [
                    635.4751586914063,
                    521.1753540039063
                ]
            ],
            "pieceId": "RPf_00359_intact_mesh"
        }
    ]
}


class TestPOC(unittest.TestCase):

    def test_toy_example(self):

        TESTDATA = StringIO("""rpf,x,y,rot
RPf_00001_intact_mesh,423,191,-0.0
RPf_00002_intact_mesh,31,828,-72.31781070566322
RPf_00003_intact_mesh,1110,-232,-217.20884021081315
RPf_00004_intact_mesh,-624,574,107.0029388205245
RPf_00005_intact_mesh,188,-44,-4.558414891213619
RPf_00006_intact_mesh,-891,1067,-45.22084517376769
RPf_00007_intact_mesh,484,-555,-165.54552155526846
RPf_00008_intact_mesh,-351,-284,-86.94886820977426
RPf_00009_intact_mesh,682,800,-193.94113144462605
RPf_00010_intact_mesh,809,1400,-131.03114133946835""")

        df = pd.read_csv(TESTDATA, sep=",")

        puzzle_dir = os.path.join(DIR_OF_PIECES_IMAGES,"RPobj_g1_o0001")
        canvas = Image.new('RGBA', (5000, 5000), (0, 0, 0, 0))

        for index, row in df.iterrows():
            piece_filename = row['rpf']
            x = int(row['x'])
            y = int(row['y'])
            rot = row['rot']

            piece_path = os.path.join(puzzle_dir, f"{piece_filename}.png")
            piece_img = Image.open(piece_path)

            piece_rot = piece_img.rotate(rot, expand=True)

            canvas.paste(piece_rot, (x, y), piece_rot)

        plt.figure()
        plt.imshow(canvas)

        plt.show()


class TestFinalAssembly(unittest.TestCase):

    def test_original_image_group_28_toy(self):
        RPf_00194 = Piece("RPf_00194","RPobj_g28_o0028")
        RPf_00194.load_original_image()
        RPf_00194.load_polygon()

        RPf_00197 = Piece("RPf_00197","RPobj_g28_o0028")
        RPf_00197.load_original_image()
        RPf_00197.load_polygon()
        
        fig2, ax2 = plt.subplots()
        img_final = restore_assembly_img.restore_final_assembly_image(correct_pairwise_data)
        ax2.imshow(img_final)
        plt.show()